/**
 * @preserve This generated code and related technologies are covered by patents
 * or patents pending by Appcelerator, Inc.
 * 
 * WARNING: this file is generated and will be overwritten
 * It was generated from <%=gen.filename%> on <%=new Date%>
 */
<% gen.imports.forEach(function(i){ -%>
<%- i %>
<% }) -%>


@interface JSValue(SEL)
+(JSValue*)valueWithSelector:(SEL)selector inContext:(JSContext*)context;
-(SEL)toSelector;
@end


@protocol <%=gen.prefix%>CallbackExport <JSExport>
-(id)selector;
@end

@interface <%=gen.prefix%>Callback : NSObject<<%=gen.prefix%>CallbackExport>
{
	JSManagedValue *callback;
}
-(id)initWithCallback:(JSValue*)cb;
@end

@implementation <%=gen.prefix%>Callback

-(id)initWithCallback:(JSValue*)cb {
	if ((self = [super init])) {
		callback = [[JSManagedValue alloc] initWithValue:cb];
		[cb.context.virtualMachine addManagedReference:callback withOwner:self];
	}
	return self;
}

-(void)dealloc {
	[[callback value].context.virtualMachine removeManagedReference:callback withOwner:self];
}

-(void)action:(id)sender {
	JSValue *fn = [callback value];
	if (fn!=nil) 
	{
		[fn callWithArguments:@[sender]];
	}
}

-(id)selector {
	return [JSValue valueWithSelector:@selector(action:) inContext:[JSContext currentContext]];
}

@end

@interface Foo : NSObject
-(void)action:(id)sender;
@end


@implementation Foo
-(void)dealloc {
	NSLog(@"FOo dealoc");
}
-(void)action:(id)sender {
	NSLog(@"FOOOOOOO!");
}
@end


<%- gen.code %>


